stateDiagram-v2
    [*] --> アプリ初期化

    state アプリ初期化 {
        [*] --> ローカルストレージ読み込み
        ローカルストレージ読み込み --> 習慣データ復元
        習慣データ復元 --> タイマー設定復元
        タイマー設定復元 --> 初期画面表示
        初期画面表示 --> [*]
    }

    アプリ初期化 --> 習慣トラッカー画面

    state 習慣トラッカー画面 {
        [*] --> 習慣一覧表示
        習慣一覧表示 --> 習慣入力待機
        習慣入力待機 --> 習慣追加処理 : 習慣名入力+追加ボタン
        習慣追加処理 --> 習慣一覧表示 : 追加完了
        習慣入力待機 --> 習慣完了切り替え : チェックボックスクリック
        習慣完了切り替え --> 習慣一覧表示 : 状態更新完了
        習慣入力待機 --> 習慣削除処理 : 削除ボタンクリック
        習慣削除処理 --> 習慣一覧表示 : 削除完了
        習慣入力待機 --> 全チェック解除処理 : 全解除ボタンクリック
        全チェック解除処理 --> 習慣一覧表示 : 全解除完了
    }

    state 学習タイマー画面 {
        [*] --> タイマー停止中
        
        state タイマー停止中 {
            [*] --> 設定表示
            設定表示 --> 時間設定入力 : 設定値変更
            時間設定入力 --> 設定バリデーション : 保存ボタン
            設定バリデーション --> 設定保存完了 : バリデーション成功
            設定保存完了 --> 設定表示 : 設定更新
            設定バリデーション --> 設定エラー表示 : バリデーション失敗
            設定エラー表示 --> 設定表示 : エラー確認
            設定表示 --> 表示タイプ切り替え : 切り替えボタン
            表示タイプ切り替え --> 設定表示 : 表示更新
        }
        
        タイマー停止中 --> タイマー動作中 : 開始ボタン[残り時間>0]
        タイマー停止中 --> 開始エラー : 開始ボタン[残り時間=0]
        開始エラー --> タイマー停止中 : エラー確認
        
        state タイマー動作中 {
            [*] --> カウントダウン中
            カウントダウン中 --> カウントダウン中 : 1秒経過/残り時間-1
            カウントダウン中 --> タイマー終了処理 : 残り時間=0
            
            state タイマー終了処理 {
                [*] --> 通知音再生
                通知音再生 --> 終了アラート表示
                終了アラート表示 --> 自動記録作成
                自動記録作成 --> タイマータイプ切り替え
                タイマータイプ切り替え --> 次タイマー判定
                次タイマー判定 --> 自動開始 : 次タイマー時間>0
                次タイマー判定 --> 停止状態 : 次タイマー時間=0
                自動開始 --> [*]
                停止状態 --> [*]
            }
            
            タイマー終了処理 --> カウントダウン中 : 自動開始
        }
        
        タイマー動作中 --> タイマー一時停止中 : 一時停止ボタン
        
        state タイマー一時停止中 {
            [*] --> 一時停止表示
            一時停止表示 --> 手動記録作成 : 記録ボタン
            手動記録作成 --> 一時停止表示 : 記録完了
        }
        
        タイマー一時停止中 --> タイマー動作中 : 開始ボタン
        タイマー一時停止中 --> タイマー停止中 : リセットボタン
        タイマー動作中 --> タイマー停止中 : リセットボタン
        
        state 記録管理 {
            [*] --> 記録一覧表示
            記録一覧表示 --> 記録クリア確認 : 記録全クリアボタン
            記録クリア確認 --> 記録全削除 : 確認OK
            記録全削除 --> 記録一覧表示 : 削除完了
            記録クリア確認 --> 記録一覧表示 : 確認キャンセル
        }
        
        タイマー停止中 --> 記録管理 : 記録操作
        タイマー一時停止中 --> 記録管理 : 記録操作
        記録管理 --> タイマー停止中 : 記録操作完了
        記録管理 --> タイマー一時停止中 : 記録操作完了
    }

    state 画面切り替え {
        習慣トラッカー画面 --> 学習タイマー画面 : 学習タイマーボタン
        学習タイマー画面 --> 習慣トラッカー画面 : 習慣トラッカーボタン
    }

    state 設定表示モード {
        作業時間設定表示 --> 休憩時間設定表示 : 切り替えボタン
        休憩時間設定表示 --> 作業時間設定表示 : 切り替えボタン
    }

    state タイマーモード {
        作業タイマー --> 休憩タイマー : 作業時間終了
        休憩タイマー --> 作業タイマー : 休憩時間終了
    }

    note right of タイマー終了処理
        - 通知音再生
        - 終了アラート表示
        - 自動記録作成
        - タイマータイプ切り替え
        - 次タイマー自動開始判定
    end note

    note right of 設定バリデーション
        - 数値チェック
        - 負の値チェック
        - 秒の範囲チェック
        - 両方0秒チェック
    end note